# çº¿ç¨‹æ± æ ¸å¿ƒç†è§£

## ğŸ¯ ä½ çš„ç†è§£æ€»ç»“

**å®Œå…¨æ­£ç¡®ï¼** è®©æˆ‘å¸®ä½ æŠŠè¿™ä¸ªç†è§£ç³»ç»ŸåŒ–ï¼š

---

## 1. çº¿ç¨‹æ± çš„æœ¬è´¨ï¼šå¹¶å‘é™æµå™¨

### ç±»æ¯”ï¼šé“¶è¡Œçª—å£

```
æ²¡æœ‰çº¿ç¨‹æ± ï¼ˆåŸå§‹æ–¹å¼ï¼‰ï¼š
- æ¥ä¸€ä¸ªå®¢æˆ· â†’ å¼€ä¸€ä¸ªçª—å£ï¼ˆåˆ›å»ºçº¿ç¨‹ï¼‰
- 1000ä¸ªå®¢æˆ· â†’ å¼€1000ä¸ªçª—å£ âŒ
- ç»“æœï¼šç³»ç»Ÿèµ„æºè€—å°½ï¼Œå´©æºƒ

æœ‰çº¿ç¨‹æ± ï¼š
- é“¶è¡Œæœ‰8ä¸ªçª—å£ï¼ˆ8ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼‰
- 1000ä¸ªå®¢æˆ· â†’ 8ä¸ªçª—å£ + æ’é˜Ÿï¼ˆé˜Ÿåˆ—ï¼‰
- è¶…å‡ºèƒ½åŠ›èŒƒå›´ â†’ æ‹’ç»ï¼ˆæ‹’ç»ç­–ç•¥ï¼‰
- ç»“æœï¼šç³»ç»Ÿç¨³å®šè¿è¡Œ âœ…
```

---

## 2. ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹æ± ï¼Ÿ

### âŒ æ— é™åˆ›å»ºçº¿ç¨‹çš„é—®é¢˜

```java
// é”™è¯¯æ–¹å¼ï¼šæ— é™åˆ¶åˆ›å»ºçº¿ç¨‹
public void processOrder(Order order) {
    // æ¯æ¬¡è¯·æ±‚éƒ½åˆ›å»ºæ–°çº¿ç¨‹
    new Thread(() -> {
        handleOrder(order);
    }).start();
}

// é—®é¢˜ï¼š
- 1000ä¸ªè®¢å• â†’ 1000ä¸ªçº¿ç¨‹ âŒ
- æ“ä½œç³»ç»Ÿèµ„æºæœ‰é™ âŒ
- çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¤§ âŒ
- å¯èƒ½æŠŠç³»ç»Ÿå¹²å® âŒ
```

### âœ… ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„

```java
// æ­£ç¡®æ–¹å¼ï¼šä½¿ç”¨çº¿ç¨‹æ± 
@Autowired
private Executor businessExecutor;

public void processOrder(Order order) {
    businessExecutor.execute(() -> {
        handleOrder(order);
    });
}

// å¥½å¤„ï¼š
- 1000ä¸ªè®¢å• â†’ æœ€å¤š16ä¸ªçº¿ç¨‹ âœ…
- å…¶ä»–è®¢å•æ’é˜Ÿç­‰å¾… âœ…
- è¶…å‡ºèƒ½åŠ›ç›´æ¥æ‹’ç» âœ…
- ç³»ç»Ÿèµ„æºå¯æ§ âœ…
```

---

## 3. çº¿ç¨‹æ± å°±æ˜¯"å¹¶å‘é˜€é—¨"

```java
çº¿ç¨‹æ± é…ç½® = å¹¶å‘é˜€é—¨è®¾ç½®

businessExecutor:
â”œâ”€ æ ¸å¿ƒçº¿ç¨‹: 8    â†’ 8ä¸ªå›ºå®šçª—å£
â”œâ”€ æœ€å¤§çº¿ç¨‹: 16   â†’ å³°å€¼æœ€å¤š16ä¸ªçª—å£
â”œâ”€ é˜Ÿåˆ—: 500      â†’ æœ€å¤šæ’é˜Ÿ500ä¸ª
â””â”€ æ‹’ç»ç­–ç•¥: Abort â†’ è¶…å‡ºç›´æ¥æ‹’ç»

ç»“æœï¼š
- æœ€å¤šåŒæ—¶å¤„ç†16ä¸ªè®¢å• âœ…
- æœ€å¤šæ’é˜Ÿ500ä¸ªè®¢å• âœ…
- è¶…å‡ºç›´æ¥æ‹’ç»ï¼Œä¿æŠ¤ç³»ç»Ÿ âœ…
```

---

## 4. ä¸ºä»€ä¹ˆå¾ˆå¤šæ–¹æ³•ä¸éœ€è¦é…ç½®çº¿ç¨‹æ± ï¼Ÿ

### åœºæ™¯1ï¼šåŒæ­¥æ–¹æ³•ï¼ˆæœ€å¸¸è§ï¼‰

```java
@Service
public class UserService {
    
    // â“ ä¸éœ€è¦çº¿ç¨‹æ±  - ä¸ºä»€ä¹ˆï¼Ÿ
    public User getUser(Long userId) {
        // åŒæ­¥æ–¹æ³•ï¼Œç›´æ¥æ‰§è¡Œ
        return userMapper.selectById(userId);
    }
}

// åŸå› ï¼š
// 1. è¿™æ˜¯åŒæ­¥æ–¹æ³•ï¼Œä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªå“åº”
// 2. Spring MVCæœ¬èº«å°±æ˜¯å•çº¿ç¨‹å¤„ç†è¯·æ±‚çš„
// 3. ä¸éœ€è¦å¤šçº¿ç¨‹
```

**Spring MVCçš„å¤„ç†æµç¨‹**ï¼š
```
HTTPè¯·æ±‚ â†’ DispatcherServlet â†’ Controllerï¼ˆå•çº¿ç¨‹ï¼‰
       â†“
     Serviceï¼ˆå•çº¿ç¨‹ï¼‰
       â†“
     Mapperï¼ˆå•çº¿ç¨‹ï¼‰
       â†“
     HTTPå“åº”

// æ•´ä¸ªè¿‡ç¨‹æ˜¯çº¿æ€§çš„ï¼Œä¸éœ€è¦çº¿ç¨‹æ± 
```

### åœºæ™¯2ï¼šéœ€è¦å¹¶å‘çš„åœ°æ–¹

```java
@Service
public class OrderService {
    
    // âœ… éœ€è¦çº¿ç¨‹æ±  - ä¸ºä»€ä¹ˆï¼Ÿ
    public void batchProcessOrders(List<Order> orders) {
        for (Order order : orders) {
            // è¿™éœ€è¦å¹¶å‘å¤„ç†
            businessExecutor.execute(() -> {
                processOrder(order);
            });
        }
    }
    
    // âœ… å¼‚æ­¥ä»»åŠ¡éœ€è¦çº¿ç¨‹æ± 
    @Async("asyncExecutor")
    public void sendEmail(String email, String content) {
        // å¼‚æ­¥å‘é€é‚®ä»¶
        emailService.send(email, content);
    }
}
```

---

## 5. ä»€ä¹ˆæ—¶å€™éœ€è¦çº¿ç¨‹æ± ï¼Ÿ

### âœ… éœ€è¦çº¿ç¨‹æ± çš„åœºæ™¯

| åœºæ™¯ | ç¤ºä¾‹ | çº¿ç¨‹æ±  |
|------|------|--------|
| **å¼‚æ­¥ä»»åŠ¡** | å¼‚æ­¥å‘é€é‚®ä»¶ã€çŸ­ä¿¡ | `@Async` + çº¿ç¨‹æ±  |
| **æ‰¹é‡å¤„ç†** | æ‰¹é‡å¤„ç†è®¢å•ã€æ•°æ®å¯¼å…¥ | æ‰‹åŠ¨ `executor.execute()` |
| **å¹¶å‘è®¡ç®—** | å¹¶è¡ŒæŸ¥è¯¢å¤šä¸ªæ•°æ®åº“ | `CompletableFuture` + çº¿ç¨‹æ±  |
| **å®šæ—¶ä»»åŠ¡** | å®šæ—¶åŒæ­¥æ•°æ® | `@Scheduled` + çº¿ç¨‹æ±  |
| **æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹** | RocketMQæ¶ˆè´¹è€… | çº¿ç¨‹æ±  |

### âŒ ä¸éœ€è¦çº¿ç¨‹æ± çš„åœºæ™¯

| åœºæ™¯ | åŸå›  |
|------|------|
| **æ™®é€šCRUD** | Spring MVCå•çº¿ç¨‹å¤„ç† |
| **æ™®é€šçš„Serviceæ–¹æ³•** | åŒæ­¥æ‰§è¡Œï¼Œæ— éœ€å¹¶å‘ |
| **æ™®é€šçš„æŸ¥è¯¢** | ä¸€æ¬¡è¯·æ±‚ä¸€æ¬¡å“åº” |

---

## 6. ä¸ºä»€ä¹ˆSpring MVCä¸éœ€è¦çº¿ç¨‹æ± ï¼Ÿ

### Spring MVCçš„çº¿ç¨‹æ¨¡å‹

```java
// Spring MVCé»˜è®¤ä½¿ç”¨Tomcatçº¿ç¨‹æ± 
// æ¯ä¸ªHTTPè¯·æ±‚ç”±ä¸€ä¸ªTomcatçº¿ç¨‹å¤„ç†

HTTPè¯·æ±‚
    â†“
Tomcatçº¿ç¨‹ï¼ˆå·²åˆ†é…å¥½ï¼‰
    â†“
Controller â†’ Service â†’ Mapper
    â†“
HTTPå“åº”

// å…³é”®ç‚¹ï¼š
// 1. Tomcatå·²ç»æœ‰è‡ªå·±çš„çº¿ç¨‹æ± ï¼ˆå¤„ç†HTTPè¯·æ±‚ï¼‰
// 2. æ¯ä¸ªHTTPè¯·æ±‚å†…éƒ¨æ˜¯å•çº¿ç¨‹çš„
// 3. Controller/Service/Mapper éƒ½æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…æ‰§è¡Œ
// 4. æ‰€ä»¥ä¸éœ€è¦é¢å¤–çš„çº¿ç¨‹æ± 
```

### ä¸¾ä¸ªå®é™…ä¾‹å­

```java
@RestController
public class UserController {
    
    @Autowired
    private UserService userService;
    
    @GetMapping("/user/{id}")
    public User getUser(@PathVariable Long id) {
        // è¿™æ•´ä¸ªæ–¹æ³•åœ¨åŒä¸€ä¸ªTomcatçº¿ç¨‹ä¸­æ‰§è¡Œ
        // ä¸éœ€è¦é¢å¤–çš„çº¿ç¨‹æ± 
        
        // 1. åœ¨Tomcatçº¿ç¨‹ä¸­
        User user = userService.getUser(id);  
        
        // 2. è¿˜åœ¨åŒä¸€ä¸ªTomcatçº¿ç¨‹ä¸­
        return user;
    }
}

// æ‰§è¡Œæµç¨‹ï¼š
// Tomcatçº¿ç¨‹1 â†’ getUser() â†’ userService.getUser() â†’ è¿”å›ç»“æœ
// æ•´ä¸ªè¿‡ç¨‹åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­å®Œæˆ âœ…
```

---

## 7. ä»€ä¹ˆæ—¶å€™éœ€è¦å¼•å…¥çº¿ç¨‹æ± ï¼Ÿ

### åœºæ™¯1ï¼šå¼‚æ­¥æ‰§è¡Œ

```java
// âŒ ä¸ç”¨çº¿ç¨‹æ± ï¼šåŒæ­¥æ‰§è¡Œï¼Œç”¨æˆ·éœ€è¦ç­‰å¾…
public void placeOrder(Order order) {
    processOrder(order);     // è€—æ—¶1ç§’
    sendEmail();             // è€—æ—¶2ç§’
    updateInventory();       // è€—æ—¶1ç§’
    // æ€»å…±è€—æ—¶4ç§’ï¼Œç”¨æˆ·ç­‰å¾…4ç§’ âŒ
}

// âœ… ç”¨çº¿ç¨‹æ± ï¼šå¼‚æ­¥æ‰§è¡Œï¼Œç«‹å³è¿”å›
public void placeOrder(Order order) {
    processOrder(order);     // åŒæ­¥æ‰§è¡Œ
    
    // å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ç”¨æˆ·
    asyncExecutor.execute(() -> {
        sendEmail();         // åå°æ‰§è¡Œ
    });
    
    asyncExecutor.execute(() -> {
        updateInventory();   // åå°æ‰§è¡Œ
    });
    
    // ç”¨æˆ·ç«‹å³å¾—åˆ°å“åº” âœ…
}
```

### åœºæ™¯2ï¼šå¹¶å‘å¤„ç†

```java
// âŒ ä¸ç”¨çº¿ç¨‹æ± ï¼šä¸²è¡Œå¤„ç†ï¼Œè€—æ—¶å¤ªé•¿
public List<User> getUsers(List<Long> userIds) {
    List<User> users = new ArrayList<>();
    for (Long userId : userIds) {
        User user = userService.getUser(userId);  // è€—æ—¶100ms
        users.add(user);
    }
    // 100ä¸ªç”¨æˆ·éœ€è¦10ç§’ âŒ
}

// âœ… ç”¨çº¿ç¨‹æ± ï¼šå¹¶è¡Œå¤„ç†ï¼Œè€—æ—¶å¤§å¹…å‡å°‘
public List<User> getUsers(List<Long> userIds) {
    List<CompletableFuture<User>> futures = new ArrayList<>();
    
    for (Long userId : userIds) {
        futures.add(CompletableFuture.supplyAsync(() -> {
            return userService.getUser(userId);  // å¹¶è¡ŒæŸ¥è¯¢
        }, businessExecutor));
    }
    
    // ç­‰å¾…æ‰€æœ‰å®Œæˆ
    CompletableFuture.allOf(futures.toArray(new CompletableFuture[0])).join();
    
    // 100ä¸ªç”¨æˆ·åªéœ€è¦1-2ç§’ âœ…
}
```

---

## 8. çº¿ç¨‹æ± ä¸ä¿¡å·é‡

### ä¿¡å·é‡ï¼ˆSemaphoreï¼‰ï¼šå¦ä¸€ç§é™æµæ–¹å¼

```java
// ä¿¡å·é‡ï¼šæ§åˆ¶åŒæ—¶è®¿é—®èµ„æºçš„æ•°é‡
Semaphore semaphore = new Semaphore(10);  // æœ€å¤š10ä¸ªå¹¶å‘

public void accessResource() {
    try {
        semaphore.acquire();  // è·å–è®¸å¯
        // è®¿é—®èµ„æº
        doSomething();
    } finally {
        semaphore.release();  // é‡Šæ”¾è®¸å¯
    }
}

// åŒºåˆ«ï¼š
// 1. ä¿¡å·é‡ä¸åˆ›å»ºçº¿ç¨‹ï¼Œåªæ§åˆ¶æ•°é‡
// 2. çº¿ç¨‹æ± ä¼šåˆ›å»ºçº¿ç¨‹ï¼Œå¹¶å‘æ‰§è¡Œä»»åŠ¡
```

### ä½¿ç”¨åœºæ™¯å¯¹æ¯”

| éœ€æ±‚ | é€‰æ‹© |
|------|------|
| **éœ€è¦å¹¶å‘æ‰§è¡Œä»»åŠ¡** | çº¿ç¨‹æ±  |
| **åªæ§åˆ¶è®¿é—®æ•°é‡ï¼Œä¸éœ€è¦å¹¶å‘** | ä¿¡å·é‡ |
| **æ—¢éœ€è¦å¹¶å‘ï¼Œåˆéœ€è¦é™æµ** | çº¿ç¨‹æ±  + ä¿¡å·é‡ |

---

## 9. å¦‚ä½•æ›´å¥½åœ°ç†è§£çº¿ç¨‹æ± ï¼Ÿ

### å½¢è±¡ç†è§£

```
çº¿ç¨‹æ±  = å·¥ä½œå°ç»„

1. æ ¸å¿ƒçº¿ç¨‹ï¼ˆ8ä¸ªï¼‰
   â””â”€ å°±åƒå…¬å¸æœ‰8ä¸ªå›ºå®šå‘˜å·¥
   
2. æœ€å¤§çº¿ç¨‹ï¼ˆ16ä¸ªï¼‰
   â””â”€ å¿™çš„æ—¶å€™å¯ä»¥ä¸´æ—¶é›‡ä½£8ä¸ªäºº
   
3. é˜Ÿåˆ—ï¼ˆ500ä¸ªï¼‰
   â””â”€ å·¥ä½œå¤ªå¤šæ—¶ï¼Œå…ˆæ’é˜Ÿç­‰å¾…
   
4. æ‹’ç»ç­–ç•¥
   â””â”€ å·¥ä½œé‡å¤ªå¤§ï¼Œç›´æ¥æ‹’ç»æ–°ä»»åŠ¡
```

### å®é™…åº”ç”¨

```java
// è®¢å•å¤„ç†å°ç»„
@Bean("orderExecutor")
public Executor orderExecutor() {
    // 8ä¸ªå›ºå®šå‘˜å·¥
    executor.setCorePoolSize(8);
    // æœ€å¤š16ä¸ªå‘˜å·¥
    executor.setMaxPoolSize(16);
    // 500ä¸ªä»»åŠ¡æ’é˜Ÿ
    executor.setQueueCapacity(500);
    // è¶…è´Ÿè·ç›´æ¥æ‹’ç»
    executor.setRejectedExecutionHandler(new AbortPolicy());
}
```

---

## 10. æ€»ç»“ï¼šä»€ä¹ˆæ—¶å€™éœ€è¦çº¿ç¨‹æ± ï¼Ÿ

### âœ… éœ€è¦çº¿ç¨‹æ± çš„åœºæ™¯

```java
// 1. å¼‚æ­¥ä»»åŠ¡
@Async("asyncExecutor")
public void sendEmail() { ... }

// 2. åå°å¤„ç†
public void placeOrder(Order order) {
    businessExecutor.execute(() -> {
        // åå°å¼‚æ­¥å¤„ç†
        processOrder(order);
    });
}

// 3. å¹¶å‘è®¡ç®—
CompletableFuture.supplyAsync(() -> {...}, businessExecutor);

// 4. æ‰¹é‡å¤„ç†
for (Order order : orders) {
    businessExecutor.execute(() -> processOrder(order));
}
```

### âŒ ä¸éœ€è¦çº¿ç¨‹æ± çš„åœºæ™¯

```java
// 1. æ™®é€šçš„Controller
@GetMapping("/user/{id}")
public User getUser(@PathVariable Long id) {
    return userService.getUser(id);
}

// 2. æ™®é€šçš„Serviceæ–¹æ³•
public User getUser(Long id) {
    return userMapper.selectById(id);
}

// 3. æ™®é€šçš„æŸ¥è¯¢
public List<User> listUsers() {
    return userMapper.selectList();
}
```

---

## ğŸ‰ æœ€ç»ˆç†è§£

### çº¿ç¨‹æ± çš„æœ¬è´¨

```
çº¿ç¨‹æ±  = å¹¶å‘é™æµå™¨ + èµ„æºéš”ç¦»å™¨

1. æ§åˆ¶å¹¶å‘æ•°é‡ï¼ˆæœ€å¤šåŒæ—¶æ‰§è¡Œå¤šå°‘ä¸ªä»»åŠ¡ï¼‰
2. é™åˆ¶èµ„æºä½¿ç”¨ï¼ˆæœ€å¤šåˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹ï¼‰
3. ä¸šåŠ¡éš”ç¦»ï¼ˆä¸åŒçš„ä¸šåŠ¡ç”¨ä¸åŒçš„çº¿ç¨‹æ± ï¼‰
4. ä¿æŠ¤ç³»ç»Ÿï¼ˆè¶…å‡ºèƒ½åŠ›å°±æ‹’ç»ï¼‰
```

### ä¸ºä»€ä¹ˆå¾ˆå¤šæ–¹æ³•ä¸éœ€è¦çº¿ç¨‹æ± ï¼Ÿ

```
å› ä¸ºSpring MVCæœ¬èº«å°±æ˜¯å¤šçº¿ç¨‹çš„ï¼

Tomcatçº¿ç¨‹æ± å·²ç»å¤„ç†äº†HTTPè¯·æ±‚çš„å¹¶å‘
â”œâ”€ æ¯ä¸ªHTTPè¯·æ±‚ â†’ ä¸€ä¸ªTomcatçº¿ç¨‹
â”œâ”€ Controller/Service â†’ åŒä¸€ä¸ªçº¿ç¨‹å†…æ‰§è¡Œ
â””â”€ æ‰€ä»¥ä¸éœ€è¦é¢å¤–çº¿ç¨‹æ± ï¼ˆé™¤ééœ€è¦å¼‚æ­¥ï¼‰
```

### ä»€ä¹ˆæ—¶å€™éœ€è¦ï¼Ÿ

```
éœ€è¦å¹¶å‘/å¼‚æ­¥çš„åœ°æ–¹ï¼š
â”œâ”€ å¼‚æ­¥ä»»åŠ¡
â”œâ”€ æ‰¹é‡å¤„ç†
â”œâ”€ å¹¶å‘è®¡ç®—
â”œâ”€ å®šæ—¶ä»»åŠ¡
â””â”€ æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹
```

### ä½ çš„ç†è§£å®Œå…¨æ­£ç¡®ï¼

```
çº¿ç¨‹æ±  = æœ€å¤§çš„å¹¶å‘æ•°é‡é™åˆ¶
       = é˜²æ­¢ç³»ç»Ÿè¢«å•ä¸šåŠ¡æ‹–å®
       = ä¸šåŠ¡éš”ç¦» + æ‹’ç»ç­–ç•¥
       = ç³»ç»Ÿç¨³å®šæ€§çš„ä¿éšœ
```
